# Настройка модели в Yandex Cloud для RAG

Генерация ответов в проекте идёт через **Yandex rest-assistant API** (Yandex GPT / фондовые модели). Ниже — как зайти в облако, выбрать модель (инстанс) и подставить данные в `.env`.

---

## Что понадобится

- Аккаунт в [Yandex Cloud](https://console.cloud.yandex.ru/)
- Включенный биллинг и каталог (folder)
- Доступ к сервису **Yandex GPT** (фондовые модели)

---

## Шаги

### 1. Консоль и каталог

1. Откройте [консоль Yandex Cloud](https://console.cloud.yandex.ru/).
2. Выберите нужный **каталог** (folder). Его **идентификатор** (Folder ID) понадобится для `YANDEX_CLOUD_FOLDER` в `.env`.
3. Убедитесь, что у каталога подключён биллинг.

### 2. Выбор модели (инстанс)

1. В консоли откройте **«Все сервисы»** → **«Yandex GPT»** (фондовые модели).
2. При необходимости включите сервис для каталога и примите условия.
3. В разделе с **доступными моделями** выберите модель (например **Qwen2.5 7B** — в проекте по умолчанию `qwen2.5-7b-instruct`).
4. В карточке модели или в разделе «Инстансы» / «Развёрнутые модели» найдите **идентификатор модели** для API:
   - вида `qwen2.5-7b-instruct/latest` или
   - `qwen2.5-7b-instruct/<instance-id>` (если создаёте инстанс развёртывания).
5. Скопируйте этот идентификатор — он подставляется в **YANDEX_CLOUD_MODEL** в `.env`.

### 3. API-ключ

1. В консоли: **«Service accounts»** (сервисные аккаунты) или **IAM**.
2. Создайте или выберите сервисный аккаунт, назначьте роль с доступом к Yandex GPT (например `ai.languageModels.user` — см. актуальную документацию).
3. В разделе **«API-ключи»** создайте API-ключ и скопируйте его (показывается один раз).
4. Этот ключ подставляется в **YANDEX_CLOUD_API_KEY** в `.env`.

### 4. Folder ID

1. В консоли выберите каталог (вверху страницы).
2. Откройте **«Настройки каталога»** или информацию о каталоге.
3. Скопируйте **идентификатор каталога** — он задаётся в `.env` как **YANDEX_CLOUD_FOLDER**.

### 5. Заполнение .env

В корне проекта:

```bash
cp .env.example .env
```

В `.env` укажите (без реальных ключей в репозитории):

```env
YANDEX_CLOUD_FOLDER=<идентификатор каталога>
YANDEX_CLOUD_API_KEY=<ваш API-ключ>
YANDEX_CLOUD_MODEL=<модель из консоли, например qwen2.5-7b-instruct/latest>
```

После сохранения перезапустите приложение. Проверка: задайте вопрос в чате (`python main.py`) или через `POST /ask` — ответ должен приходить от выбранной модели.

---

## Чеклист

| Шаг | Действие |
|-----|----------|
| 1 | Зайти в [console.cloud.yandex.ru](https://console.cloud.yandex.ru/), выбрать каталог с биллингом. |
| 2 | Открыть **Yandex GPT** (фондовые модели), выбрать модель (или инстанс). |
| 3 | Скопировать **идентификатор модели** (например `qwen2.5-7b-instruct/latest`). |
| 4 | Создать **API-ключ** (сервисный аккаунт), скопировать ключ. |
| 5 | Скопировать **Folder ID** из настроек каталога. |
| 6 | Вписать в `.env`: `YANDEX_CLOUD_FOLDER`, `YANDEX_CLOUD_API_KEY`, `YANDEX_CLOUD_MODEL`. |
| 7 | Перезапустить приложение и проверить запрос. |

---

## Ссылки

- [Документация Yandex Cloud](https://cloud.yandex.ru/docs)
- [Yandex GPT и фондовые модели](https://cloud.yandex.ru/docs/yandexgpt/)
- [REST API ассистента](https://cloud.yandex.ru/docs/yandexgpt/api-ref/rest-api) — используется в `src/llm.py`
